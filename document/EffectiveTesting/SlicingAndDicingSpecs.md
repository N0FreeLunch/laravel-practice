# 테스트 나누기 

우리가 테스트 코드를 작성할 때, 특정 테스트 코드를 수정한다고 하자. 

굉장히 많은 테스트가 쌓인 경우 하나를 수정한 후 테스트를 동작시키는데 엄청난 시간이 들 수 있다.

또한 기존의 코드를 변경하게 되면 연관된 모든 테스트 코드를 변경하지 않으면 테스트 코드를 통과하지 못 하는 경우도 생길 수 있다.

그래서 테스트 하고 싶은 대상만 골라 빠르게 테스트를 수행하기 위해서 선택하는 기능을 제공한다. 이 기능으로 테스트 하지 않을 테스트 항목을 모두 주석 처리하는 것을 대체할 수 있다.

테스트 라이브러리는 수정중인 테스트만 동작하도록 지정하거나, 특정 태그의 테스트만 동작시키거나, 특정 이름의 테스트만 동작시키거나, 잠시 제외할 테스트를 지정할 수 있는 옵션을 제공한다.

## only

수정 중인 테스트 하나만 또는 테스트 그룹 하나만 동작시키는 옵션이다.

```php
describe('결제 시스템', function () {
    it('카드 결제 성공', function () {
        // ...
    })->only(); 

    it('무통장 입금 성공', function () {
        // ...
    });
});
```

카드 결제 항목은 테스트가 실행되지만, 무통장 입금 항목은 테스트가 실행되지 않는다.

#### 주의점

`->only()`는 테스트 한 이후에는 반드시 지워줘야 한다. 그렇지 않으면 모든 테스트의 성공 여부가 아니라 하나의 테스트만 통과한 후 테스트 코드 잘 동작했다고 판단하는 실수가 생길 수 있다.

## group

각각의 테스트 항목 또는 그룹에 태그를 붙여 태그가 특정 태그만 지정해서 테스트를 실행시키는 기능이다.

```php
it('외부 결제 API 연동', function () {
    // ...
})->group('integration', 'slow');

it('할인 금액 계산', function () {
    // ...
})->group('unit', 'fast');
```

#### 빠른 테스트만 실행하기

```
./vendor/bin/pest --group=fast
```

#### 느린 테스트만 실행하기

```
./vendor/bin/pest --group=slow
```

#### 유닛 테스트만 실행하기

```
./vendor/bin/pest --group=unit
```

#### 통합 테스트만 실행하기

```
./vendor/bin/pest --group=integration
```

### 제외하여 실행하기

`--exclude-group`를 사용하면 제외하고 실행할 수 있다.

#### 통합 테스트만 제외하고 실행하기

```
./vendor/bin/pest --exclude-group=integration
```

## 건너뛰기 (skip, todo)

지정한 테스트 항목이나 그룹을 제외시킬 때 사용한다.

코드를 수정했는데 일부 케이스에 대해서만 동작을 하지 않을 경우, 하나씩 고쳐 나가야 한다. 이를 위해서 나머지 테스트는 확인을 하면서도 아직 고쳐지지 않은 테스트는 제외하고자 할 때 사용할 수 있다.

skip과 todo는 동일한 기능이지만 의미의 차이가 있다.

### skip

로직이 있는 부분으로 작성 중이라서 테스트로 실행해서는 안 되는 로직 또는 애플리케이션 기능 변경으로 기존 테스트가 동작하지 않을 때 잠시 제외하는 용도로 사용된다.

```php
it('구형 브라우저 호환성 체크', function () {
    // ...
})->skip('IE 지원 중단으로 인해 임시 제외');
```

### todo

아직 작성되지 않은 테스트 그룹이나 항목의 실행을 건너 뛰고, 앞으로 작성되어야 할 테스트인지 테스트 결과에 포함시켜 테스트의 최종 작성에 누락이 없게 하기 위한 목적이 있다.

```php
it('환불 기능')->todo(); 
```

테스트 결과 CLI 테스트 로직이 실행되지는 않지만, "Todo: 환불 기능"이라고 표시된다.

#### Top-Down 방식과 궁합

todo는 전제적인 큰 테스트 흐름을 정하고 세부 항목을 작성하는 탑다운 방식으로 BDD의 핵심인 Outside-In 구성 방식의 코드를 작성할 때 유용하게 사용할 수 있다.

통과 되어야 할 테스트를 모두 나열한 후, 작성되어야 할 테스트를 순차적으로 채워나가는 방식으로 개발할 수 있는 도구가 된다.

## filter

테스트 그룹이나 항목의 설명을 베이스로 문자열 일치 여부로 테스트할 대상을 뽑아낼 때 사용한다. 필터에 의해 그룹의 설명이 선택되면 그룹의 하위 그룹이나 항목은 모두 실행된다.

아직 태그가 정의되지 않은 테스트를 묶어서 실행하고 싶을 때, 설명의 키워드를 토대로 테스트를 실행하기 위해서 사용한다.

설명의 키워드를 통해서 실행되기 때문에 네이밍에 규칙을 부여하거나 설명의 구분감을 느낄 수 있는 키워드를 사용하는 것이 좋다.

```php
describe('주문 프로세스', function () {
    
    it('신용카드로 결제한다', function () {
        // ...
    });

    it('무통장 입금으로 결제한다', function () {
        // ...
    });

    describe('환불 기능', function () {
        it('전액 환불 처리가 가능하다', function () {
            // ...
        });

        it('부분 환불 처리가 가능하다', function () {
            // ...
        });
    });
});
```

- '결제'라는 단어가 들어간 테스트 항목만 테스트를 실행한다.

```
./vendor/bin/pest --filter="결제"
```

- '환불'이란 단어가 들어간 테스트 항목만 테스트를 실행한다.
```
./vendor/bin/pest --filter="환불"
```

### 정규 표현식

테스트 그룹이나 항목의 키워드를 통해서 테스트 할 대상을 선택할 때 정규 표현식을 사용할 수 있다. 

```
./vendor/bin/pest --filter="/로그인$/"
```

마지막에 '로그인'으로 끝나는 그룹이나 항목만을 선택해 실행할 수 있다.

### 태그 vs 필터

소스 코드를 건드리지 않고 그룹 단위로 테스트를 실행하고 싶을 때 필터를 사용할 수 있다.

굉장히 많은 항목을 뽑아서 테스트를 하고 싶은데 모든 그룹이나 항목에 태그를 추가하기 어려운 경우, 필터를 사용해서 테스트를 한 번에 실행할 수 있다.

필터는 설명의 문자열 베이스라서 엄격한 대상 분류가 되지 않을 수 있기 때문에, 보조 도구로서 사용하며, 지속적인 테스트 코드 개선을 위해서 태그를 부여하기 위해 노력하는 편이 좋다.
